# üöÄ RentScout v1.1 - –£–ª—É—á—à–µ–Ω–∏—è (–î–µ–∫–∞–±—Ä—å 2025)

## –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ
–≠—Ç–æ—Ç —Ä–µ–ª–∏–∑ –¥–æ–±–∞–≤–ª—è–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.

---

## üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ Property ID
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–ø—ã—Ç–∫–∞ –ø—Ä–∏—Å–≤–æ–∏—Ç—å —Å—Ç—Ä–æ–∫–æ–≤—ã–π ID —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–º—É –ø–æ–ª—é –ø—Ä–∏–≤–µ–ª–∞ –∫ –æ—à–∏–±–∫–∞–º –≤–∞–ª–∏–¥–∞—Ü–∏–∏.

**–†–µ—à–µ–Ω–∏–µ:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ (MD5) –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω—ã—Ö ID –Ω–∞ –æ—Å–Ω–æ–≤–µ `source` –∏ `external_id`.

```python
hash_input = f"{prop.source}_{prop.external_id}".encode('utf-8')
hash_int = int(hashlib.md5(hash_input).hexdigest(), 16) % (10 ** 8)
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ (app/services/search.py)

---

## ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 2. –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
**–û–ø–∏—Å–∞–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–æ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ –≤ Redis –Ω–∞ 5 –º–∏–Ω—É—Ç –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ø–∞—Ä—Å–µ—Ä—ã.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- TTL: 300 —Å–µ–∫—É–Ω–¥ (5 –º–∏–Ω—É—Ç)
- –ö–ª—é—á –∫–µ—à–∞: `search:{city}:{property_type}`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
# –î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–µ—à–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ
GET /api/properties?city=–ú–æ—Å–∫–≤–∞&property_type=–ö–≤–∞—Ä—Ç–∏—Ä–∞

# –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –∑–∞ 5 –º–∏–Ω—É—Ç –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –∏–∑ –∫–µ—à–∞
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ (app/services/search.py)

---

## üîß –ù–æ–≤—ã–µ Celery –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

### 3. –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á —á–µ—Ä–µ–∑ Celery Inspect
**–û–ø–∏—Å–∞–Ω–∏–µ:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á–∞—Ö –≤ –æ—á–µ—Ä–µ–¥–∏.

**–ù–æ–≤—ã–µ endpoints:**

#### GET /api/tasks
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏ –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞—á.

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `limit` (1-100, default: 10) - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á
- `status` (PENDING, STARTED, SUCCESS, FAILURE) - —Ñ–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É

**–û—Ç–≤–µ—Ç:**
```json
{
  "total": 5,
  "limit": 10,
  "status_filter": null,
  "tasks": [
    {
      "task_id": "abc123",
      "name": "app.tasks.celery.parse_city_task",
      "status": "STARTED",
      "worker": "celery@worker1",
      "args": ["–ú–æ—Å–∫–≤–∞", "–ö–≤–∞—Ä—Ç–∏—Ä–∞"],
      "kwargs": {},
      "time_start": 1702051234.123
    }
  ],
  "workers": ["celery@worker1", "celery@worker2"],
  "registered_tasks": ["parse_city_task", "batch_parse_task"]
}
```

#### GET /api/tasks/workers/stats
–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –≤—Å–µ–º Celery —Ä–∞–±–æ—á–∏–º.

**–û—Ç–≤–µ—Ç:**
```json
{
  "online_workers": 2,
  "workers": [
    {
      "name": "celery@worker1",
      "status": "online",
      "pool": "solo",
      "max_concurrency": 4,
      "active_tasks": 2,
      "processed_tasks": 1250,
      "system": { "cpu": 25.5, "memory": 512 }
    }
  ],
  "total_active_tasks": 5,
  "registered_task_count": 12
}
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ (app/api/endpoints/tasks.py)

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫

### 4. Endpoint –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –æ—à–∏–±–æ–∫ –ø–∞—Ä—Å–µ—Ä–∞
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ù–æ–≤—ã–π endpoint –¥–ª—è —Å–ø—Ä–∞–≤–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–∏–ø–∞—Ö –æ—à–∏–±–æ–∫ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è—Ö –ø–æ –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∫–µ.

**Endpoint:** GET /api/health/errors/diagnostic

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `error_type` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–∏–ø –æ—à–∏–±–∫–∏ –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

**–ü—Ä–∏–º–µ—Ä—ã –æ—Ç–≤–µ—Ç–æ–≤:**

–ë–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞:
```json
{
  "supported_error_types": [
    "NetworkError",
    "TimeoutError",
    "RateLimitError",
    "AuthenticationError",
    "ParsingError",
    "ValidationError",
    "SourceUnavailableError",
    "DataIntegrityError",
    "ConfigurationError",
    "QuotaExceededError"
  ],
  "error_classifications": {
    "NetworkError": {
      "severity": "WARNING",
      "retryability": "RETRY_WITH_BACKOFF",
      "recommendation": "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É",
      "typical_http_code": 503
    },
    ...
  }
}
```

–° –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º:
```json
{
  "error_type": "TimeoutError",
  "details": {
    "severity": "WARNING",
    "retryability": "RETRY_WITH_BACKOFF",
    "recommendation": "–£–≤–µ–ª–∏—á—å—Ç–µ timeout –∏–ª–∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–æ–ø—ã—Ç–∫—É –ø–æ–∑–∂–µ",
    "typical_http_code": 504
  }
}
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ (app/api/endpoints/health.py)

---

## üìä –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ API

### –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ GET /api/properties

- **–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏** (AuthenticationError) ‚Üí HTTP 500 Internal Server Error
- **–í—Ä–µ–º–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏** (Network, Timeout) ‚Üí HTTP 503 Service Unavailable
- **–û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏** (ParsingError) ‚Üí HTTP 400 Bad Request
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏** —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π

–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `ErrorClassifier.classify()`.

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–æ (app/api/endpoints/properties.py)

---

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç–æ–≤

–ü–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è —É–ª—É—á—à–µ–Ω–∏–π:
- ‚úÖ **5 —Ç–µ—Å—Ç–æ–≤ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏** - –≤—Å–µ –ø—Ä–æ–π–¥–µ–Ω—ã
- ‚úÖ **6 —Ç–µ—Å—Ç–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫** - –≤—Å–µ –ø—Ä–æ–π–¥–µ–Ω—ã
- ‚úÖ **7 —Ç–µ—Å—Ç–æ–≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏** - –≤—Å–µ –ø—Ä–æ–π–¥–µ–Ω—ã
- ‚úÖ **191 —Ç–µ—Å—Ç–æ–≤ –≤—Å–µ–≥–æ** - –æ—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|--------|---------|
| app/services/search.py | ‚úÖ | –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ + –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ID |
| app/api/endpoints/tasks.py | ‚úÖ | Celery Inspect –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è |
| app/api/endpoints/health.py | ‚úÖ | –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫ |
| app/models/schemas.py | ‚úÖ | Property schema (–Ω–µ –∏–∑–º–µ–Ω—ë–Ω) |
| app/utils/parser_errors.py | ‚úÖ | ErrorClassifier (–ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω) |

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (v1.2)

- [ ] WebSocket –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- [ ] GraphQL API –≤ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ REST
- [ ] API Key –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ rate limiting –ø–æ –∫–ª—é—á–∞–º
- [ ] Webhook –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è —Å–æ–±—ã—Ç–∏–π
- [ ] –£–ª—É—á—à–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ reporting

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –¥–µ–π—Å—Ç–≤–∏–∏
```bash
# –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å (–ø–∞—Ä—Å–∏—Ç –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤)
curl -X GET "http://localhost:8000/api/properties?city=–ú–æ—Å–∫–≤–∞"

# –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –∑–∞ 5 –º–∏–Ω—É—Ç (–∏–∑ –∫–µ—à–∞)
curl -X GET "http://localhost:8000/api/properties?city=–ú–æ—Å–∫–≤–∞"
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–¥–∞—á
```bash
# –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏
curl -X GET "http://localhost:8000/api/tasks"

# –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É
curl -X GET "http://localhost:8000/api/tasks?status=STARTED"

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞–±–æ—á–∏—Ö
curl -X GET "http://localhost:8000/api/tasks/workers/stats"
```

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫
```bash
# –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ TimeoutError
curl -X GET "http://localhost:8000/api/health/errors/diagnostic?error_type=TimeoutError"
```

---

**–î–∞—Ç–∞ –≤—ã–ø—É—Å–∫–∞:** –î–µ–∫–∞–±—Ä—å 7, 2025  
**–í–µ—Ä—Å–∏—è:** 1.1.0  
**–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:** Production Ready ‚úÖ
